
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
      <link rel="shortcut icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.1.2, mkdocs-material-6.1.7">
    
    
      
        <title>å¿«é€Ÿå¼€å§‹ - Spydy</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.19753c6b.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.196e0c26.min.css">
        
      
    
    
    
      
        
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto",-apple-system,BlinkMacSystemFont,Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono",SFMono-Regular,Consolas,Menlo,monospace}</style>
      
    
    
    
    
      
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="none" data-md-color-accent="none">
      
  
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#_1" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid" aria-label="Header">
    <a href=".." title="Spydy" class="md-header-nav__button md-logo" aria-label="Spydy">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 003-3 3 3 0 00-3-3 3 3 0 00-3 3 3 3 0 003 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header-nav__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header-nav__title" data-md-component="header-title">
      
        <div class="md-header-nav__ellipsis">
          <span class="md-header-nav__topic md-ellipsis">
            Spydy
          </span>
          <span class="md-header-nav__topic md-ellipsis">
            
              å¿«é€Ÿå¼€å§‹
            
          </span>
        </div>
      
    </div>
    
      <label class="md-header-nav__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" data-md-state="active" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <button type="reset" class="md-search__icon md-icon" aria-label="Clear" data-md-component="search-reset" tabindex="-1">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Spydy" class="md-nav__button md-logo" aria-label="Spydy">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 003-3 3 3 0 00-3-3 3 3 0 00-3 3 3 3 0 003 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    Spydy
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href=".." class="md-nav__link">
      é¦–é¡µ
    </a>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        å¿«é€Ÿå¼€å§‹
        <span class="md-nav__icon md-icon"></span>
      </label>
    
    <a href="./" class="md-nav__link md-nav__link--active">
      å¿«é€Ÿå¼€å§‹
    </a>
    
      
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    ä¸€ä¸ªç®€å•çš„ä¾‹å­
  </a>
  
    <nav class="md-nav" aria-label="ä¸€ä¸ªç®€å•çš„ä¾‹å­">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    å‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿ
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    ä¸€ä¸ªå¤æ‚ç‚¹çš„ä¾‹å­
  </a>
  
</li>
      
    </ul>
  
</nav>
    
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    ä¸€ä¸ªç®€å•çš„ä¾‹å­
  </a>
  
    <nav class="md-nav" aria-label="ä¸€ä¸ªç®€å•çš„ä¾‹å­">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    å‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿ
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    ä¸€ä¸ªå¤æ‚ç‚¹çš„ä¾‹å­
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                  <h1>å¿«é€Ÿå¼€å§‹</h1>
                
                <h2 id="_1">ä¸€ä¸ªç®€å•çš„ä¾‹å­</h2>
<p>ä½œä¸ºæ¼”ç¤ºï¼Œ æˆ‘ä»¬å°†çˆ¬å–ç½‘ç«™<a href="https://dmoz-odp.org/">dmoz</a>é¦–é¡µ(å¯èƒ½éœ€è¦æ¢¯å­)ä¸‹æ–¹çš„ä¸€äº›ç»Ÿè®¡æ•°æ®ï¼Œ å¦‚å›¾æ‰€ç¤ºï¼š</p>
<p><img alt="dmoz" src="./docs/docs/img/dmoz.png" /> </p>
<p>é¦–å…ˆå‡†å¤‡å¥½éœ€è¦çˆ¬å–çš„é“¾æ¥ï¼Œæˆ‘ä»¬æŠŠç›®æ ‡è¿æ¥æ”¾å…¥åˆ°urls.txtä¸­:</p>
<pre><code>https://dmoz-odp.org
</code></pre>
<p>ç„¶åå‡†å¤‡å¥½ä¸€ä¸ªç®€å•çš„é…ç½®æ–‡ä»¶ï¼ˆmyconfig.cfgï¼‰ï¼š</p>
<pre><code>[Globals]
run_mode = once   

[PipeLine]
url = FileUrls
request = HttpGetRequest
parser = DmozParser
store = CsvStore

[FileUrls]
file_name = urls.txt

[CsvStore]
file_name = dmoz.csv
</code></pre>
<p>æœ€ååœ¨å‘½ä»¤è¡Œå¯åŠ¨spydy:</p>
<pre><code>$ spydy myconfig.cfg

Your pipeline looks like :
FileUrls â‡¨ HttpGetRequest â‡¨ DmozParser â‡¨ CsvStore
</code></pre>
<p>æ¥ç€ï¼Œ ä½ ä¼šå‘ç°åœ¨å½“å‰ç›®å½•ä¸‹é¢å‡ºç°äº†dmoz.csvï¼Œå¹¶ä¸”åœ¨dmoz.csvæ–‡ä»¶ä¸­å¤šäº†ä¸€è¡Œæˆ‘ä»¬æƒ³è¦è·å–çš„æ•°æ®ã€‚</p>
<h3 id="_2">å‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿ</h3>
<p>spydyçš„å·¥ä½œæµåœ¨è®¾è®¡ä¸Šå‚è€ƒäº†Unixç®¡é“ï¼Œ å®šä¹‰åœ¨é…ç½®æ–‡ä»¶[PipeLine]ä¸‹é¢çš„å‚æ•°å…¶å®å°±æ˜¯æˆ‘ä»¬spydyä¼š<strong>é¡ºåºæ‰§è¡Œ</strong>çš„å„ä¸ªæ­¥éª¤,æ¯”å¦‚åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­, spydyçš„å·¥ä½œæµæ˜¯è¿™æ ·çš„ï¼š</p>
<pre><code>FileUrls -&gt; HttpGetRequest -&gt; DmozParser -&gt; CsvStore
</code></pre>
<p>æ¯ä¸ªæ­¥éª¤çš„äº§å‡ºå°±æ˜¯ä¸‹ä¸€æ­¥çš„è¾“å…¥ã€‚</p>
<p>å½“ç„¶ï¼Œ æ¯ä¸ªæ­¥éª¤å¯èƒ½éœ€è¦ä¸€äº›å‚æ•°ï¼Œ æ¯”å¦‚FileUrlséœ€è¦<code>file_name</code>å‚æ•°ï¼Œ æ‰€ä»¥éœ€è¦å•ç‹¬åœ°åœ¨[FileUrls]ä¸‹é¢é…ç½®å¥½<code>file_name</code>å‚æ•°ï¼Œ å¦‚æœç”¨æˆ·æ²¡æœ‰æä¾›ç›¸åº”å‚æ•°ï¼Œ<br />
é‚£ä¹ˆspydyå°†ä½¿ç”¨é»˜è®¤å‚æ•°ã€‚</p>
<p>é…ç½®æ–‡ä»¶ä¸­[Globals]ä¸‹é¢å¯ä»¥è®¾ç½®spydyçš„å…¨å±€å‚æ•°ï¼Œ æ¯”å¦‚è¿™é‡Œçš„<code>run_mode</code>è¢«è®¾ç½®äº†<code>once</code>ï¼Œ æ‰€ä»¥åœ¨ä¸Šé¢ä¾‹å­ä¸­spydyåªä¼šå°†æ•´ä¸ªå·¥ä½œæµæ‰§è¡Œä¸€æ¬¡ã€‚</p>
<h2 id="_3">ä¸€ä¸ªå¤æ‚ç‚¹çš„ä¾‹å­</h2>
<p>åœ¨çœŸå®å¼€å‘å¼€å‘åœºæ™¯ä¸­ï¼Œ æˆ‘ä»¬å¸Œæœ›çˆ¬è™«èƒ½å¤Ÿçˆ¬çš„å¿«ï¼Œ åŒæ—¶å…¼å®¹ç”¨æˆ·çš„è‡ªå®šæ¨¡å—ã€‚æ‰€ä»¥æˆ‘ä»¬æ¥ç”¨ä½¿ç”¨spydyæ¥å¼€å‘ä¸€ä¸ªç¨å¾®å¤æ‚ä¸€ç‚¹çš„çˆ¬è™«åº”ç”¨ï¼š</p>
<ul>
<li>å‡†å¤‡ä¸€ä¸ªå¯ä»¥è®¿é—®çš„redisé”®å€¼å­˜å‚¨æ•°æ®åº“ï¼Œå½“ç„¶æˆ‘ä»¬éœ€è¦åœ¨Redisä¸­å†™å…¥ä¸€äº›URLï¼š  </li>
</ul>
<pre><code>from spydy.urls import RedisListUrls

r = RedisListUrls(list_name=&quot;/spider/testurls&quot;)  # é»˜è®¤localhost
for _ in range(10):
    r.push(&quot;https://www.dmoz-odp.org/&quot;)  
</code></pre>
<ul>
<li>
<p>ä¸€ä¸ªå¯ä»¥è®¿é—®çš„å…³ç³»å‹æ•°æ®ï¼Œ åœ¨æ•°æ®åº“å»ºç«‹ä¸€ä¸ªåä¸ºdmozçš„databaseï¼Œ ä»¥åŠä¸€ä¸ªåä¸ºstatsçš„è¡¨ï¼Œ è¡¨ä¸­éœ€è¦åŒ…å«editors, categories, sites, languagesè¿™å››ä¸ªå­—æ®µï¼ˆéƒ½æ˜¯å­—ç¬¦ä¸²ç±»å‹ï¼‰ã€‚</p>
</li>
<li>
<p>å‡†å¤‡å¥½ä¸€ä¸ªæ–‡ä»¶å¤¹(mypkg), ç”¨äºå­˜å‚¨ç”¨æˆ·çš„è‡ªå®šä¹‰æ¨¡å—ã€‚mypkgçš„ç›®å½•é•¿è¿™æ ·ï¼š</p>
</li>
</ul>
<pre><code>- mypkg
  - __init__.py
  - filters.py
</code></pre>
<p>åœ¨filters.pyä¸­å†™å…¥ï¼š</p>
<pre><code>from spydy.filters import CommonFilter

class Myfilter(CommonFilter):
    def drops(self):
        return [&quot;editors&quot;]

    def mutates(self, items):
        print(&quot;befor_filter: {}&quot;.format(items))
        items[&quot;sites&quot;] = &quot;0&quot;
        print(&quot;after_filter: {}&quot;.format(items))
        return items

</code></pre>
<p>æœ€åï¼Œ å‡†å¤‡å¥½æˆ‘ä»¬çš„spydyé…ç½®æ–‡ä»¶(myconfig2.cfg)ï¼š</p>
<pre><code>[Globals]
run_mode = async_forever
nworkers = 4

[PipeLine]
url = RedisListUrls
request = AsyncHttpGetRequest
parser = DmozParser
filter = file:mypkg.filters.Myfilter
store = DbStore

[RedisListUrls]
host = localhost
port = 6379
list_name = /spider/testurls

[DbStore]
connection_url = sqlite:///./tests/files/dmoz.db
table_name = stats
</code></pre>
<p>å½“ç„¶ï¼Œ ä½ çš„redisè¿æ¥å’Œæ•°æ®åº“è¿æ¥(ä½¿ç”¨<a href="https://docs.sqlalchemy.org/en/13/core/connections.html">sqlalchemy</a>çš„å®šä¹‰æ–¹å¼)å’Œä¸Šé¢çš„æœªå¿…ç›¸åŒï¼Œ è¯·æ ¹æ®è‡ªå·±çš„æƒ…å†µè¿›è¡Œä¿®æ”¹ã€‚</p>
<p>ä¸‡äº‹ä¿±å¤‡ï¼Œ è®©æˆ‘ä»¬è¿è¡Œspydyå§ï¼š</p>
<pre><code>$ spydy myconfig2.cfg

Your pipeline looks like :
RedisListUrls â‡¨ AsyncHttpGetRequest â‡¨ DmozParser â‡¨ Myfilter â‡¨ DbStore

befor_mutate: {'categories': '1,031,722', 'languages': '90', 'sites': '3,861,202'}
after_mutate: {'categories': '1,031,722', 'languages': '90', 'sites': '0'}
befor_mutate: {'categories': '1,031,722', 'languages': '90', 'sites': '3,861,202'}
after_mutate: {'categories': '1,031,722', 'languages': '90', 'sites': '0'}
befor_mutate: {'categories': '1,031,722', 'languages': '90', 'sites': '3,861,202'}
after_mutate: {'categories': '1,031,722', 'languages': '90', 'sites': '0'}
befor_mutate: {'categories': '1,031,722', 'languages': '90', 'sites': '3,861,202'}
after_mutate: {'categories': '1,031,722', 'languages': '90', 'sites': '0'}
...

</code></pre>
<p>è¿è¡Œç»“æŸï¼Œ å¯ä»¥åˆ°æˆ‘ä»¬çš„æ•°æ®åº“ä¸­æ£€æŸ¥ä¸€ä¸‹æ˜¯ä¸æ˜¯æˆåŠŸå­˜å‚¨äº†åˆšæ‰çˆ¬å–çš„æ•°æ®ã€‚</p>
<pre><code>Tips:
   é€šå¸¸å¯ä»¥é€šè¿‡spydyç»„ä»¶çš„åç§°æ¥ç¡®å®šä¸€ä¸ªç»„ä»¶æ˜¯ä¸æ˜¯æ”¯æŒå¼‚æ­¥çš„ï¼Œ å¦‚æœç»„ä»¶å¸¦æœ‰Asyncå‰ç¼€ï¼Œ é‚£ä¹ˆè¯¥ç»„ä»¶å°±æ˜¯æ”¯æŒå¼‚æ­¥çš„ã€‚
</code></pre>
<p>ğŸ‘‰ æƒ³è¦äº†è§£spydyçš„æ›´å¤šç‰¹æ€§ï¼Œ è¯·ç§»æ­¥<a href="https://superjcd.github.io/spydy/">spydyå®˜æ–¹æ–‡æ¡£</a>.</p>
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid" aria-label="Footer">
        
          <a href=".." class="md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
            </div>
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                é¦–é¡µ
              </div>
            </div>
          </a>
        
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../assets/javascripts/vendor.0ac82a11.min.js"></script>
      <script src="../assets/javascripts/bundle.f81dfb4d.min.js"></script><script id="__lang" type="application/json">{"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing"}</script>
      
      <script>
        app = initialize({
          base: "..",
          features: [],
          search: Object.assign({
            worker: "../assets/javascripts/worker/search.4ac00218.min.js"
          }, typeof search !== "undefined" && search)
        })
      </script>
      
    
  </body>
</html>