
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
      <link rel="shortcut icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.1.2, mkdocs-material-6.1.7">
    
    
      
        <title>快速开始 - Spydy</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.19753c6b.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.196e0c26.min.css">
        
      
    
    
    
      
        
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto",-apple-system,BlinkMacSystemFont,Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono",SFMono-Regular,Consolas,Menlo,monospace}</style>
      
    
    
    
    
      
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="none" data-md-color-accent="none">
      
  
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#spydy" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid" aria-label="Header">
    <a href=".." title="Spydy" class="md-header-nav__button md-logo" aria-label="Spydy">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 003-3 3 3 0 00-3-3 3 3 0 00-3 3 3 3 0 003 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header-nav__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header-nav__title" data-md-component="header-title">
      
        <div class="md-header-nav__ellipsis">
          <span class="md-header-nav__topic md-ellipsis">
            Spydy
          </span>
          <span class="md-header-nav__topic md-ellipsis">
            
              快速开始
            
          </span>
        </div>
      
    </div>
    
      <label class="md-header-nav__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" data-md-state="active" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <button type="reset" class="md-search__icon md-icon" aria-label="Clear" data-md-component="search-reset" tabindex="-1">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Spydy" class="md-nav__button md-logo" aria-label="Spydy">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 003-3 3 3 0 00-3-3 3 3 0 00-3 3 3 3 0 003 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    Spydy
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href=".." class="md-nav__link">
      首页
    </a>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        快速开始
        <span class="md-nav__icon md-icon"></span>
      </label>
    
    <a href="./" class="md-nav__link md-nav__link--active">
      快速开始
    </a>
    
      
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#spydy" class="md-nav__link">
    安装spydy
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    一个简单的例子
  </a>
  
    <nav class="md-nav" aria-label="一个简单的例子">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    发生了什么？
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    一个复杂点的例子
  </a>
  
    <nav class="md-nav" aria-label="一个复杂点的例子">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_4" class="md-nav__link">
    发生了什么？
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#spydy_1" class="md-nav__link">
    spydy可以无缝兼容用户的自定义模块
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#spydy_2" class="md-nav__link">
    spydy可以支持并发
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#spydy_3" class="md-nav__link">
    spydy提供便利的组件
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
    
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#spydy" class="md-nav__link">
    安装spydy
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    一个简单的例子
  </a>
  
    <nav class="md-nav" aria-label="一个简单的例子">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    发生了什么？
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    一个复杂点的例子
  </a>
  
    <nav class="md-nav" aria-label="一个复杂点的例子">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_4" class="md-nav__link">
    发生了什么？
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#spydy_1" class="md-nav__link">
    spydy可以无缝兼容用户的自定义模块
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#spydy_2" class="md-nav__link">
    spydy可以支持并发
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#spydy_3" class="md-nav__link">
    spydy提供便利的组件
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                  <h1>快速开始</h1>
                
                <p><img alt="logo" src="./docs/docs/img/spydy.svg" />  </p>
<hr />
<p>目前虽然有很多的开源的爬虫框架和工具， 但是它们大多无法同时兼顾<strong>用户友好</strong>以及<strong>良好性能</strong>这两个特性。
所以对于为什么要使用<a href="https://superjcd.github.io/spydy/">spydy</a>这个问题， 简而言之， spydy可以帮助使用者以最快的速度以及更为直观的方式， 开发和部署高性能的网络爬虫。</p>
<h2 id="spydy">安装spydy</h2>
<pre><code>$ pip install spydy
</code></pre>
<h2 id="_1">一个简单的例子</h2>
<p>作为演示， 我们将爬取网站<a href="https://dmoz-odp.org/">dmoz</a>首页(可能需要梯子)下方的一些统计数据， 如图所示：</p>
<p><img alt="dmoz" src="./docs/docs/img/dmoz.png" /> </p>
<p>首先准备好需要爬取的链接，我们把目标连接放入到urls.txt中:</p>
<pre><code>https://dmoz-odp.org
</code></pre>
<p>然后准备好一个简单的配置文件（myconfig.cfg）：</p>
<pre><code>[Globals]
run_mode = once   

[PipeLine]
url = FileUrls
request = HttpGetRequest
parser = DmozParser
store = CsvStore

[FileUrls]
file_name = urls.txt

[CsvStore]
file_name = dmoz.csv
</code></pre>
<p>最后在命令行启动spydy:</p>
<pre><code>$ spydy myconfig.cfg

Your pipeline looks like :
FileUrls ⇨ HttpGetRequest ⇨ DmozParser ⇨ CsvStore
</code></pre>
<p>接着， 你会发现在当前目录下面出现了dmoz.csv，并且在dmoz.csv文件中多了一行我们想要获取的数据。</p>
<h3 id="_2">发生了什么？</h3>
<p>spydy的工作流在设计上参考了Unix管道， 定义在配置文件[PipeLine]下面的参数其实就是我们spydy会<strong>顺序执行</strong>的各个步骤,  比如在上面的例子中，<br />
spydy的工作流是这样的：</p>
<pre><code>FileUrls -&gt; HttpGetRequest -&gt; DmozParser -&gt; CsvStore
</code></pre>
<p>每个步骤的产出就是下一步的输入。</p>
<p>当然， 每个步骤可能需要一些参数， 比如FileUrls需要<code>file_name</code>参数， 所以需要单独地在[FileUrls]下面配置好<code>file_name</code>参数， 如果用户没有提供相应参数，<br />
那么spydy将使用默认参数。</p>
<p>配置文件中[Globals]下面可以设置spydy的全局参数， 比如这里的<code>run_mode</code>被设置了<code>once</code>， 所以在上面例子中spydy只会将整个工作流执行一次。</p>
<h2 id="_3">一个复杂点的例子</h2>
<p>在真实开发开发场景中， 我们希望爬虫能够做到：
* 兼容使用者的自定义模块&amp;功能， 比如兼容用户自定义网页解析模块
* 支持并发&amp;异步
* 支持数据持久化， 比如将数据写入数据库
...</p>
<p>OK， 以上这些spydy都可以支持。我们再来看一个稍微复杂一点的例子作为演示， 在此之前请确保：  </p>
<ul>
<li>有一个可以访问的redis键值存储数据库，当然我们需要在Redis中写入一些URL：  </li>
</ul>
<pre><code>from spydy.urls import RedisListUrls

r = RedisListUrls(list_name=&quot;/spider/testurls&quot;)  # 默认localhost
for _ in range(10):
    r.push(&quot;https://www.dmoz-odp.org/&quot;)  
</code></pre>
<ul>
<li>
<p>一个可以访问的关系型数据， 在数据库建立一个名为dmoz的database， 以及一个名为stats的表， 表中需要包含editors, categories, sites, languages这四个字段（都是字符串类型）。</p>
</li>
<li>
<p>准备好一个文件夹(mypkg), 用于存储用户的自定义模块。mypkg的目录长这样：</p>
</li>
</ul>
<pre><code>- mypkg
  - __init__.py
  - filters.py
</code></pre>
<p>在filters.py中写入：</p>
<pre><code>from spydy.filters import CommonFilter

class Myfilter(CommonFilter):
    def drops(self):
        return [&quot;editors&quot;]

    def mutates(self, items):
        print(&quot;befor_filter: {}&quot;.format(items))
        items[&quot;sites&quot;] = &quot;0&quot;
        print(&quot;after_filter: {}&quot;.format(items))
        return items

</code></pre>
<p>最后， 准备好我们的spydy配置文件(myconfig2.cfg)：</p>
<pre><code>[Globals]
run_mode = async
nworkers = 4

[PipeLine]
url = RedisListUrls
request = AsyncHttpGetRequest
parser = DmozParser
filter = file:mypkg.filters.Myfilter
store = DbStore

[RedisListUrls]
host = localhost
port = 6379
list_name = /spider/testurls

[DbStore]
connection_url = sqlite:///./tests/files/dmoz.db
table_name = stats
</code></pre>
<p>当然， 你的redis连接和数据库连接(使用<a href="https://docs.sqlalchemy.org/en/13/core/connections.html">sqlalchemy</a>的定义方式)和上面的未必相同， 请根据自己的情况进行修改。</p>
<p>万事俱备， 让我们运行spydy吧：</p>
<pre><code>$ spydy myconfig2.cfg

Your pipeline looks like :
RedisListUrls ⇨ AsyncHttpGetRequest ⇨ DmozParser ⇨ Myfilter ⇨ DbStore

befor_mutate: {'categories': '1,031,722', 'languages': '90', 'sites': '3,861,202'}
after_mutate: {'categories': '1,031,722', 'languages': '90', 'sites': '0'}
befor_mutate: {'categories': '1,031,722', 'languages': '90', 'sites': '3,861,202'}
after_mutate: {'categories': '1,031,722', 'languages': '90', 'sites': '0'}
befor_mutate: {'categories': '1,031,722', 'languages': '90', 'sites': '3,861,202'}
after_mutate: {'categories': '1,031,722', 'languages': '90', 'sites': '0'}
befor_mutate: {'categories': '1,031,722', 'languages': '90', 'sites': '3,861,202'}
after_mutate: {'categories': '1,031,722', 'languages': '90', 'sites': '0'}
...

</code></pre>
<h3 id="_4">发生了什么？</h3>
<h3 id="spydy_1">spydy可以无缝兼容用户的自定义模块</h3>
<p>我们在<em>PipeLine</em>中我们加入了自定义的过滤模块(继承自<code>spydy.filters.CommonFilter</code>)，由于<strong>filter</strong>被定义在<strong>parser</strong>的后面， 所以<strong>filter</strong>会处理从<strong>parsers</strong>返回的结果。在这个过程中, 如上面日志中显示的那样， 结果数据发生了改变(sites变成了0).</p>
<h3 id="spydy_2">spydy可以支持并发</h3>
<p>spydy通过<strong>协程</strong>支持并发。在<em>myconfig2.cfg</em>配置文件的<em>[Globals]</em>部分下， 我们将run_mode设置成了<code>async</code>， 同时将<code>num_workers</code>设置成了4，同时我们把<strong>request</strong>过程从<code>HttpGetRequest</code>改为<code>AsyncHttpGetRequest</code>, 意味着spydy将并发执行四个异步任务。这样网络请求就会以异步的方式进行。</p>
<pre><code>Tips:
   通常可以通过spydy组件的名称来确定一个组件是不是支持异步的， 如果组件带有Async前缀， 那么该组件就是支持异步的。
</code></pre>
<h3 id="spydy_3">spydy提供便利的组件</h3>
<p>在上面的例子中， 我们使用了spydy的<em>RedisListUrls</em>来获取url, 同时利用spdydy自带的持久化组件，来快速地存储数据。spydy通过为使用者提供常见的组件， 来大大简化使用者的开发工作。</p>
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid" aria-label="Footer">
        
          <a href=".." class="md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
            </div>
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                首页
              </div>
            </div>
          </a>
        
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../assets/javascripts/vendor.0ac82a11.min.js"></script>
      <script src="../assets/javascripts/bundle.f81dfb4d.min.js"></script><script id="__lang" type="application/json">{"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing"}</script>
      
      <script>
        app = initialize({
          base: "..",
          features: [],
          search: Object.assign({
            worker: "../assets/javascripts/worker/search.4ac00218.min.js"
          }, typeof search !== "undefined" && search)
        })
      </script>
      
    
  </body>
</html>